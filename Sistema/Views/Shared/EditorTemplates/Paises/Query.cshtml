@using Sistema.Util;

<table id="@Sistema.Util.SelectFunctions.getInputId("grid", Html.ClientPrefixName().ToString())" style="width: 100%" class="table-select">
    <thead>
        <tr>
            <th></th>
            <th style="width:20%">Id.</th>
            <th style="width:80%">Nome</th>
        </tr>
    </thead>
</table>

@Html.AddScriptBlock(
    @<script type="text/javascript">
        $(function () {

            $(document).on('@Sistema.Util.SelectFunctions.getInputId(Html.ClientPrefixName().ToString(), "Open")', function (e, data) {
                $('#@Sistema.Util.SelectFunctions.getInputId("grid", Html.ClientPrefixName().ToString())').DataTable().draw()
            });

            var table = $('#@Sistema.Util.SelectFunctions.getInputId("grid", Html.ClientPrefixName().ToString())').dataTable({
                ajax: { url: "@Url.Action("JsQuery", "Paises")" },
                sDom: "<'row'<'visible-lg visible-md hidden-sm hidden-xs  col-md-6'l><'col-md-6'f><'col-md-12'r>>t<'row'<'visible-lg visible-md hidden-sm hidden-xs col-md-6'i><'col-md-6'p>>",
                iDeferLoading: 0,
                columns: [
                    {
                        sortable: false,
                        data: null,
                        sClass: 'center',
                        mRender: function (data) {
                            return '<a class="btn btn-success btn-sm" href="#" title="Selecionar registro"><i class="fa fa-check"></i> </a>';
                        }
                    },
                    { data: "id", sortable: true },
                    { data: "text", sortable: true },
                ],
                fnServerParams: null,
                fnInfoCallback: null,
                initComplete: function (settings, json) {
                    $('#@Sistema.Util.SelectFunctions.getInputId("grid_filter", Html.ClientPrefixName().ToString()) input').focus();
                },
                fnRowCallback: function (nRow, aData) {
                    //console.log(aData);
                    $('td', nRow).off('click').on('click', function (e) {
                        $(document).trigger('@Sistema.Util.SelectFunctions.getInputId(Html.ClientPrefixName().ToString(), "AfterSelect")', { id: aData.id, text: aData.text });
                        e.preventDefault()
                    });

                    $('td a', nRow).off('click').on('click', function (e) {
                        $(document).trigger('@Sistema.Util.SelectFunctions.getInputId(Html.ClientPrefixName().ToString(), "AfterSelect")', { id: aData.id, text: aData.text });
                        e.preventDefault()
                    });
                },
            });
        });
    </script>
)