@using Sistema.Util;
@{
    var Prefix = Html.ClientPrefixName().ToString();
}

<div id="@Sistema.Util.SelectFunctions.getInputId("Modal",Prefix)" class="modal fade" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Cadastrar Estado</h4>
            </div>
            <div class="modal-body">

                <div class="form-group">
                    @Html.Label("nmMarca", "Nome")
                    <div class="@Util.Input12">
                        @Html.TextBox("nmMarca", null, new { @class = "form-control", maxlength = "100" })
                        @Html.ValidationMessage("nmMarca", null, new { @class = "help-block" })
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" id="@Sistema.Util.SelectFunctions.getInputId("btnBack",Prefix)" class="btn btn-default" data-dismiss="modal"><i class="fa fa-arrow-left"></i> Voltar</button>
                <button type="button" id="@Sistema.Util.SelectFunctions.getInputId("btnSave",Prefix)" class="btn btn-success"><i class="fa fa-save"></i> Salvar</button>
            </div>
        </div>
    </div>
</div>

@Html.AddScriptBlock(
    @<script type="text/javascript">
        $(function () {
            $('#@Sistema.Util.SelectFunctions.getInputId("Modal", Prefix)').on('shown.bs.modal', function () {
                shared_function["@Prefix"].init();
            });
            $('#@Sistema.Util.SelectFunctions.getInputId("btnSave", Prefix)').on('click', function () {
                shared_function["@Prefix"].insert();
            });
        });
        shared_function["@Prefix"] = {
            getForm: function () {
                var form = {
                    nmMarca: $('#@Sistema.Util.SelectFunctions.getInputId("nmMarca", Prefix)')
                }
                return form;
            },
            clear: function () {
                var form = shared_function["@Prefix"].getForm();
                shared_function["@Prefix"].button('reset');
                form.nmMarca.val("");
                form.nmMarca.focus();
            },
            init: function () {
                shared_function["@Prefix"].clear();
            },
            isValid: function (form) {

                var valid = true;
                var msg = "<h4>Verifique os campos abaixo</h4>";

                if (IsNullOrEmpty(form.nmMarca.val())) {
                    msg += "Por favor, informe o nome! <br/>";
                    form.nmMarca.blink();
                    valid = false;
                }

                if (!valid) {
                    shared_function["@Prefix"].button('reset');
                    $.notify(msg, { type: "danger", z_index: 2031 });
                }
                return valid;
            },
            getModel: function (form) {
                var model = {
                    nmMarca: form.nmMarca.val()
                }
                return model;
            },
            button: function (value) {
                $('#@Sistema.Util.SelectFunctions.getInputId("btnSave", Prefix)').button(value);
                $('#@Sistema.Util.SelectFunctions.getInputId("btnBack", Prefix)').button(value);

            },
            insert: function () {
                shared_function["@Prefix"].button('loading');
                var form = shared_function["@Prefix"].getForm();

                if (shared_function["@Prefix"].isValid(form)) {

                    var model = shared_function['@Prefix'].getModel(form);
                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: '@Url.Action("jsCreate", "Marca")',
                        data: model,
                        success: function (data) {
                            shared_function["@Prefix"].button('reset');
                            if (data.type == "success") {
                                $('#@Sistema.Util.SelectFunctions.getInputId("Modal", Prefix)').modal('hide');
                                shared_function["@Prefix"].clear();

                                $(document).trigger('@Sistema.Util.SelectFunctions.getInputId("Insert",Prefix)', data.model);
                            } else {
                                $('#@Prefix' + '_' + data.field).blink();
                                $('#@Prefix' + '_' + data.field).select().focus();
                            }
                            $.notify(data.message, { type: data.type, z_index: 2031 });

                        },
                        error: function (request) {
                            shared_function["@Prefix"].button('reset');
                            Functions.checkRequest(request);
                        }
                    });
                }
            }
        }
</script>
)